
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Lecture des fichiers et installation des librairies nécesssaires
```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(scales)


annualdeath <- read.csv("../Dataset/annual-number-of-deaths-by-cause.csv", header = TRUE)
governmentEducationExpenditure  <- read.csv("../Dataset/total-government-expenditure-on-education-gdp.csv", header = TRUE)
enrolment_ratio_teritiary_education <- read.csv("../Dataset/enrolment-ratio-teritiary-education.csv", header = TRUE)
waterAccess <- read.csv("../Dataset/water-withdrawals-per-capita.csv")
poptotal <- read.csv("../Dataset/number-of-deaths-per-year.csv")
```

enlever les régions
```{r}

annualdeath <- annualdeath %>% filter(Code != "");
governmentEducationExpenditure <- governmentEducationExpenditure  %>% filter(Code != "");
waterAccess <- waterAccess %>% filter(Code != "");

```
changer le nom des colonnes
```{r}
colnames(annualdeath) <- c("Country","Code","Year","Meningitis","Alzheimers disease","Parkinsons disease","Nutritional deficiencies","Malaria",
"Drowning","Interpersonal violence", "Maternal disorders", "HIV AIDS" , "Drug use disorders", "Tuberculosis", "Cardiovascular diseases", "Lower respiratory infections", "Neonatal disorders","Alcohol use disorders", "Self harm", "Exposure to forces of nature", "Diarrheal diseases", "Environmental heat and cold exposure", "Neoplasms", "Conflict and terrorism", "Diabetes mellitus", "Chronic kidney disease", "Poisonings", "Protein energy malnutrition", "Road injuries", "Chronic respiratory diseases", "Cirrhosis and other chronic liver diseases", "Digestive diseases","Fire heat and hot substances","Acute hepatitis", "Measles"
)
colnames(governmentEducationExpenditure) <- c("Country","Code","Year", "GPD spent in Education (%)")

colnames(enrolment_ratio_teritiary_education) <- c("Country","Year","Gender","Age", "Units", "Enrolment ration (%)")

colnames(waterAccess) <- c("Country","Code", "Year", "Water withdrawal per capita ()")

colnames(poptotal) <- c("Country","Code", "Year","Deaths", "Death_mean")
```
supprimer les colonnes inutiles
```{r}

annualdeath <- select(annualdeath,-Code, -`Interpersonal violence`, -`Fire heat and hot substances`, -`Road injuries`, -`Conflict and terrorism`, -`Exposure to forces of nature`, -`Self harm` , -`Alzheimers disease` , -`Parkinsons disease`, -`Drowning`, -`Maternal disorders`, -`Drug use disorders`, -`Alcohol use disorders` , -`Environmental heat and cold exposure`, -`Poisonings`, -`Neonatal disorders`, -`Nutritional deficiencies` , -`Meningitis`)

governmentEducationExpenditure <- select(governmentEducationExpenditure, -Code)

enrolment_ratio_teritiary_education <- select(enrolment_ratio_teritiary_education, -Units, -Age,)

waterAccess <- select(waterAccess, -Code)

poptotal <- select(poptotal,Country, Year, Deaths)

```

unifier certaines maladies sous la même catégorie

```{r}
annualdeath$`Respiratory diseases` <- annualdeath$`Lower respiratory infections` + annualdeath$`Chronic respiratory diseases`

annualdeath$`Digestives diseases` <- annualdeath$`Digestive diseases` + annualdeath$`Cirrhosis and other chronic liver diseases` + annualdeath$`Acute hepatitis`

annualdeath$`Infectious diseases` <- annualdeath$`Malaria` + annualdeath$`Tuberculosis` + annualdeath$`HIV AIDS` + annualdeath$`Measles` + annualdeath$`Diarrheal diseases`

annualdeath$`Other non communicable diseases` <- annualdeath$`Chronic kidney disease` + annualdeath$`Protein energy malnutrition`


annualdeath <- select(annualdeath, -`Lower respiratory infections` , -`Chronic respiratory diseases`, -`Tuberculosis` , -`Digestive diseases`, -`Cirrhosis and other chronic liver diseases`, -`Acute hepatitis`, -`Malaria` , -`HIV AIDS`, -`Measles` , -`Chronic kidney disease` , -`Protein energy malnutrition` ,-`Diarrheal diseases`)
```

connaitre les pays que l'on observera pas
```{r}
pays_non_observés_annual_death <- annualdeath %>% group_by(Country) %>% filter(n() < 5)
pays_non_observés_annual_death <- pays_non_observés_annual_death %>% group_by(Country) %>% count()


pays_non_observés_government_exp <- governmentEducationExpenditure %>% group_by(Country) %>% filter(n() < 5)
pays_non_observés_government_exp <- pays_non_observés_government_exp %>% group_by(Country) %>% count()

pays_non_observés_enrolment_ratio_teritiary_education <- enrolment_ratio_teritiary_education %>% group_by(Country) %>% filter(n() < 5)
pays_non_observés_enrolment_ratio_teritiary_education <- pays_non_observés_enrolment_ratio_teritiary_education  %>% group_by(Country) %>% count()

pays_non_observés_water_access <- waterAccess  %>% group_by(Country) %>% filter(n() < 1)
pays_non_observés_water_access <- pays_non_observés_water_access  %>% group_by(Country) %>% count()

print(pays_non_observés_government_exp)
print(pays_non_observés_annual_death)
print(pays_non_observés_enrolment_ratio_teritiary_education)
print(pays_non_observés_water_access)
```
On a 30 pays non observés pour la table government expenditure, 0 pour annual death et 2 pour enrolment ratio

Filter seuleument les données de 1990 à 2010

```{r}
annualdeath <- annualdeath %>% filter(Year<2011);

governmentEducationExpenditure <- governmentEducationExpenditure  %>% filter(Year<2011) %>%filter(Year>1989);

enrolment_ratio_teritiary_education <- enrolment_ratio_teritiary_education  %>% filter(Year<2011) %>%filter(Year>1989)  %>%filter(Gender == "All genders") ;

waterAccess <- waterAccess %>% filter(Year<2011) %>%filter(Year>1989)

poptotal <- poptotal  %>% filter(Year<2011) %>%filter(Year>1989)
```

enlever les pays ayant moins de 20% et la colonne "World"
```{r}
governmentEducationExpenditure <- governmentEducationExpenditure %>% group_by(Country) %>% filter(n() > 5) %>% filter(Country != "World")

annualdeath <- annualdeath %>% group_by(Country) %>% filter(n() > 5) %>% filter(Country != "World")

enrolment_ratio_teritiary_education <- enrolment_ratio_teritiary_education %>% group_by(Country) %>% filter(n() > 5) %>% filter(!grepl("^MDG_", Country))

waterAccess <- waterAccess %>% group_by(Country) %>% filter(n() > 1)

```

nombre d'observations par pays en 20 ans
```{r}
governmentEducationExpenditure %>% group_by(Country)%>%count()

annualdeath %>% group_by(Country)%>%count()

enrolment_ratio_teritiary_education %>% group_by(Country)%>%count()

waterAccess %>% group_by(Country)%>%count()
```

nombre de pays observés par table
```{r}
governmentEducationExpenditure %>% group_by(Country)%>%summarise() %>% nrow()
annualdeath  %>% group_by(Country)%>%summarise() %>% nrow()
enrolment_ratio_teritiary_education  %>% group_by(Country)%>%summarise() %>% nrow()
waterAccess  %>% group_by(Country)%>%summarise() %>% nrow()
```
merge la table poptotal et annualdeath pour obtenir la proportion des morts de certaines maladies comparé à leur population totale
```{r}

annualdeath <- merge(annualdeath, poptotal[, c("Country", "Year", "Deaths")], by = c("Country", "Year"))

annualdeath$`Cardiovascular diseases prop (%)` <- annualdeath$`Cardiovascular diseases` / annualdeath$Deaths *100
annualdeath$`Neoplasms prop (%)` <- annualdeath$Neoplasms / annualdeath$Deaths *100
annualdeath$`Diabetes mellitus prop (%)` <- annualdeath$`Diabetes mellitus` / annualdeath$Deaths *100
annualdeath$`Respiratory diseases prop (%)` <- annualdeath$`Respiratory diseases` /  annualdeath$Deaths *100
annualdeath$`Digestives diseases prop (%)` <- annualdeath$`Digestives diseases` /  annualdeath$Deaths *100
annualdeath$`Infectious diseases prop (%)` <- annualdeath$`Infectious diseases` /  annualdeath$Deaths *100
annualdeath$`Other non communicable diseases (%)` <- annualdeath$`Other non communicable diseases` /  annualdeath$Deaths *100
```

trouver les pays avec les pourcentages les plus et moins élevés en moyenne sur 20 ans
```{r}
governmentEducationExpenditure_mean <- governmentEducationExpenditure %>%
  group_by(Country) %>%
  summarise(Mean_GPD_spent = mean(`GPD spent in Education (%)`))

governmentEducationExpenditure_valmax <- governmentEducationExpenditure_mean %>% top_n(5, wt = `Mean_GPD_spent`)

governmentEducationExpenditure_valmin <- governmentEducationExpenditure_mean %>% slice_min(`Mean_GPD_spent`, n = 5)

governmentEducationExpenditure_minmax <- rbind(governmentEducationExpenditure_valmin, governmentEducationExpenditure_valmax)

print(governmentEducationExpenditure_valmin$Country)

print(governmentEducationExpenditure_valmax$Country)
```
On selectionne au sein de la table principale les données de ces
pays 
```{r}

pays_combinés_gov_exp <- filter(governmentEducationExpenditure, Country %in% governmentEducationExpenditure_minmax$Country)

pays_h1_death <- select(annualdeath,Country,Year,`Cardiovascular diseases prop (%)`) %>% filter(Country %in% c("Cuba","Denmark",  "Djibouti", "Lesotho","Norway","Monaco", "Sudan", "Dominican Republic" , "Central African Republic","Cambodia"))  

```
Une fois trouvés, nous pouvons analyser les données de ces pays à l'aide de graphes de lignes

```{r}
couleurs <- c("#00AFBB", "#E7B800", "#FC4E07", "#A1D99B", "#8C564B", "#E377C2", "#7F7F7F", "#084081", "#FCCDE5", "#006400")

ggplot(data = pays_combinés_gov_exp, aes(x = Year, y = `GPD spent in Education (%)`, group = Country, color = Country)) +
  geom_line() +
  labs(title = "Education Expenditure compared to total GDP",
       x = "Country",
       y = "GPD spent in Education (%)") +
  theme_minimal() +
   scale_color_manual(values = couleurs)

```
```{r}


ggplot(data = pays_h1_death, aes(x = Year, y = `Cardiovascular diseases prop (%)`, group = Country, color = Country)) +
  geom_line() +
  labs(title = "Cardiovascular diseases per total number of",
       x = "Country",
       y = "Cardiovascular diseases (%)") +
  theme_minimal() +
 scale_color_manual(values = couleurs)

```



