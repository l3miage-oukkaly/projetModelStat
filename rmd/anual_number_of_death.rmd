
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Lecture des fichiers et installation des librairies nécesssaires
```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(scales)


annualdeath <- read.csv("../Dataset/annual-number-of-deaths-by-cause.csv", header = TRUE)
governmentEducationExpenditure  <- read.csv("../Dataset/total-government-expenditure-on-education-gdp.csv", header = TRUE)
enrolment_ratio_teritiary_education <- read.csv("../Dataset/enrolment-ratio-teritiary-education.csv", header = TRUE)
waterAccess <- read.csv("../Dataset/water-withdrawals-per-capita.csv")
poptotal <- read.csv("../Dataset/number-of-deaths-per-year.csv")
population <- read.csv("../Dataset/population-and-demography.csv")
```

enlever les codes des régions
```{r}

annualdeath <- annualdeath %>% filter(Code != "");
governmentEducationExpenditure <- governmentEducationExpenditure  %>% filter(Code != "");
waterAccess <- waterAccess %>% filter(Code != "");

```

changer le nom des colonnes
```{r}
colnames(annualdeath) <- c("Country","Code","Year","Meningitis","Alzheimers disease","Parkinsons disease","Nutritional deficiencies","Malaria",
"Drowning","Interpersonal violence", "Maternal disorders", "HIV AIDS" , "Drug use disorders", "Tuberculosis", "Cardiovascular diseases", "Lower respiratory infections", "Neonatal disorders","Alcohol use disorders", "Self harm", "Exposure to forces of nature", "Diarrheal diseases", "Environmental heat and cold exposure", "Neoplasms", "Conflict and terrorism", "Diabetes mellitus", "Chronic kidney disease", "Poisonings", "Protein energy malnutrition", "Road injuries", "Chronic respiratory diseases", "Cirrhosis and other chronic liver diseases", "Digestive diseases","Fire heat and hot substances","Acute hepatitis", "Measles"
)
colnames(governmentEducationExpenditure) <- c("Country","Code","Year", "GPD spent in Education (%)")

colnames(enrolment_ratio_teritiary_education) <- c("Country","Year","Gender","Age", "Units", "Enrolment ratio (%)")

colnames(waterAccess) <- c("Country","Code", "Year", "Water withdrawal per capita ()")

colnames(poptotal) <- c("Country","Code", "Year","Deaths", "Death_mean")
```
supprimer les colonnes inutiles
```{r}

annualdeath <- select(annualdeath,-Code, -`Interpersonal violence`, -`Fire heat and hot substances`, -`Road injuries`, -`Conflict and terrorism`, -`Exposure to forces of nature`, -`Self harm` , -`Alzheimers disease` , -`Parkinsons disease`, -`Drowning`, -`Maternal disorders`, -`Drug use disorders`, -`Alcohol use disorders` , -`Environmental heat and cold exposure`, -`Poisonings`, -`Neonatal disorders`, -`Nutritional deficiencies` , -`Meningitis`)

governmentEducationExpenditure <- select(governmentEducationExpenditure, -Code)

enrolment_ratio_teritiary_education <- select(enrolment_ratio_teritiary_education, -Units, -Age,)

waterAccess <- select(waterAccess, -Code)

poptotal <- select(poptotal,Country, Year, Deaths)

population <- select(population, Country.name , Year, Population)

colnames(population) <- c("Country", "Year","Population")

```

unifier certaines maladies sous la même catégorie

```{r}
annualdeath$`Respiratory diseases` <- annualdeath$`Lower respiratory infections` + annualdeath$`Chronic respiratory diseases`

annualdeath$`Digestives diseases` <- annualdeath$`Digestive diseases` + annualdeath$`Cirrhosis and other chronic liver diseases` + annualdeath$`Acute hepatitis`

annualdeath$`Infectious diseases` <- annualdeath$`Malaria` + annualdeath$`Tuberculosis` + annualdeath$`HIV AIDS` + annualdeath$`Measles` + annualdeath$`Diarrheal diseases`

annualdeath$`Other non communicable diseases` <- annualdeath$`Chronic kidney disease` + annualdeath$`Protein energy malnutrition`


annualdeath <- select(annualdeath, -`Lower respiratory infections` , -`Chronic respiratory diseases`, -`Tuberculosis` , -`Digestive diseases`, -`Cirrhosis and other chronic liver diseases`, -`Acute hepatitis`, -`Malaria` , -`HIV AIDS`, -`Measles` , -`Chronic kidney disease` , -`Protein energy malnutrition` ,-`Diarrheal diseases`)
```


Filter seuleument les données de 1990 à 2010

```{r}
annualdeath <- annualdeath %>% filter(Year<2011);

governmentEducationExpenditure <- governmentEducationExpenditure  %>% filter(Year<2011) %>%filter(Year>1989);

enrolment_ratio_teritiary_education <- enrolment_ratio_teritiary_education  %>% filter(Year<2011) %>%filter(Year>1989)  %>%filter(Gender == "All genders") ;

waterAccess <- waterAccess %>% filter(Year<2011) %>%filter(Year>1989)

poptotal <- poptotal  %>% filter(Year<2011) %>%filter(Year>1989)

population <- population %>% filter(Year<2011) %>%filter(Year>1989)
```

enlever les pays ayant moins de 20% et la colonne "World"
```{r}
governmentEducationExpenditure <- governmentEducationExpenditure %>% group_by(Country) %>% filter(n() > 5) %>% filter(Country != "World")

annualdeath <- annualdeath %>% group_by(Country) %>% filter(n() > 5) %>% filter(Country != "World")

enrolment_ratio_teritiary_education <- enrolment_ratio_teritiary_education %>% group_by(Country) %>% filter(n() > 5) %>% filter(!grepl("^MDG_", Country))

waterAccess <- waterAccess %>% group_by(Country) %>% filter(n() == 5)

```

nombre d'observations par pays en 20 ans
```{r}
governmentEducationExpenditure %>% group_by(Country)%>%count()

annualdeath %>% group_by(Country)%>%count()

enrolment_ratio_teritiary_education %>% group_by(Country)%>%count()

waterAccess %>% group_by(Country)%>%count()

```

nombre de pays observés par table
```{r}
governmentEducationExpenditure %>% group_by(Country)%>%summarise() %>% nrow()
annualdeath  %>% group_by(Country)%>%summarise() %>% nrow()
enrolment_ratio_teritiary_education  %>% group_by(Country)%>%summarise() %>% nrow()
waterAccess  %>% group_by(Country)%>%summarise() %>% nrow()
```
merge la table poptotal et annualdeath pour obtenir la proportion des morts de certaines maladies comparé à leur population totale
```{r}

annualdeath <- merge(annualdeath, poptotal[, c("Country", "Year", "Deaths")], by = c("Country", "Year"))

annualdeath$`Cardiovascular diseases prop (%)` <- annualdeath$`Cardiovascular diseases` / annualdeath$Deaths *100
annualdeath$`Neoplasms prop (%)` <- annualdeath$Neoplasms / annualdeath$Deaths *100
annualdeath$`Diabetes mellitus prop (%)` <- annualdeath$`Diabetes mellitus` / annualdeath$Deaths *100
annualdeath$`Respiratory diseases prop (%)` <- annualdeath$`Respiratory diseases` /  annualdeath$Deaths *100
annualdeath$`Digestives diseases prop (%)` <- annualdeath$`Digestives diseases` /  annualdeath$Deaths *100
annualdeath$`Infectious diseases prop (%)` <- annualdeath$`Infectious diseases` /  annualdeath$Deaths *100
annualdeath$`Other non communicable diseases (%)` <- annualdeath$`Other non communicable diseases` /  annualdeath$Deaths *100


```

trouver les pays avec les pourcentages les plus et moins élevés en moyenne sur 20 ans
```{r}
governmentEducationExpenditure_mean <- governmentEducationExpenditure %>%
  group_by(Country) %>%
  summarise(Mean_GPD_spent = mean(`GPD spent in Education (%)`))

governmentEducationExpenditure_valmax <- governmentEducationExpenditure_mean %>% top_n(5, wt = `Mean_GPD_spent`)

governmentEducationExpenditure_valmin <- governmentEducationExpenditure_mean %>% slice_min(`Mean_GPD_spent`, n = 5)

governmentEducationExpenditure_minmax <- rbind(governmentEducationExpenditure_valmin, governmentEducationExpenditure_valmax)

governmentEducationExpenditure_minmax$Country <- factor(governmentEducationExpenditure_minmax$Country, levels = governmentEducationExpenditure_minmax$Country[order(governmentEducationExpenditure_minmax$`Mean_GPD_spent`)])

```
On selectionne au sein de la table principale les données de ces pays 
```{r}

pays_h1_death <- select(annualdeath,Country,Year,`Infectious diseases prop (%)`) %>% filter(Country %in% c("Cuba","Denmark",  "Djibouti", "Lesotho","Norway","Monaco", "Sudan", "Dominican Republic" , "Central African Republic","Cambodia"))  

pays_h1_death_mean <- pays_h1_death %>%
  group_by(Country) %>%
  summarise(Mean_death_ID = mean(`Infectious diseases prop (%)`))

death_valmax <- pays_h1_death_mean %>% top_n(5, wt = `Mean_death_ID`)

death_valmin <- pays_h1_death_mean %>% slice_min(`Mean_death_ID`, n = 5)

death_minmax <- rbind(death_valmin, death_valmax)

death_minmax$Country <- factor(death_minmax$Country, levels = death_minmax$Country[order(death_minmax$`Mean_death_ID`)])

```
Une fois trouvés, nous pouvons analyser les données de ces pays à l'aide de graphes de lignes



```{r}
ggplot(governmentEducationExpenditure_minmax, aes(x= Country, y= `Mean_GPD_spent`)) + geom_bar(stat = "identity") + labs(title="Education Expenditure compared to total GDP", x="Country", y="mean GPD spent in Education (%)") + scale_y_continuous(limits = c(0, NA), breaks = pretty_breaks(n = 10), labels = comma_format()) + scale_fill_discrete(name = "Country") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  
```
```{r}
ggplot(death_minmax, aes(x= Country, y= `Mean_death_ID`)) + geom_bar(stat = "identity") + labs(title="Infectious diseases per total number of death(10 countries education exp", x="Country", y="mean death by Infectious diseases (%)") +  scale_y_continuous(limits = c(0, NA), breaks = pretty_breaks(n = 10),labels = comma_format()) + scale_fill_discrete(name = "Country") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
```

trouver les pays avec les pourcentages les plus et moins élevés en moyenne sur 20 ans
```{r}
enrolmentratio_mean <- enrolment_ratio_teritiary_education %>%
  group_by(Country) %>%
  summarise(Enrolment_ratio = mean(`Enrolment ratio (%)`))

enrolmentratio_mean <- enrolmentratio_mean %>% filter(Enrolment_ratio > 0.1)

enrolmentratio_valmax <- enrolmentratio_mean %>% top_n(5, wt = Enrolment_ratio)

enrolmentratio_valmin <- enrolmentratio_mean %>% slice_min(Enrolment_ratio, n = 5)

enrolmentratio_minmax <- rbind(enrolmentratio_valmin, enrolmentratio_valmax)


enrolmentratio_minmax$Country <- factor(enrolmentratio_minmax$Country, levels = enrolmentratio_minmax$Country[order(enrolmentratio_minmax$Enrolment_ratio)])

ggplot(enrolmentratio_minmax, aes(x= Country, y= `Enrolment_ratio`)) + geom_bar(stat = "identity") + labs(title="mean enrolment ratio", x="Country", y="mean enrolment ratio (%)") + scale_y_continuous(limits = c(0, NA), breaks = pretty_breaks(n = 10), labels = comma_format()) + scale_fill_discrete(name = "Country") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

```

On selectionne au sein de la table principale les données de ces pays 
```{r}
pays_h2_death <- select(annualdeath,Country,Year,`Infectious diseases prop (%)`) %>% filter(Country %in% c("Sao Tome and Principe","Malawi" ,"Tanzania","Saint Vincent and the Grenadines","Niger","Australia","Canada","Finland", "North Korea","United States")) 

pays_h2_death_mean <- pays_h2_death %>%
  group_by(Country) %>%
  summarise(Mean_death_ID = mean(`Infectious diseases prop (%)`))

death_valmax2 <- pays_h2_death_mean %>% top_n(5, wt = `Mean_death_ID`)

death_valmin2 <- pays_h2_death_mean %>% slice_min(`Mean_death_ID`, n = 5)

death_minmax2 <- rbind(death_valmin2, death_valmax2)

death_minmax2$Country <- factor(death_minmax2$Country, levels = death_minmax2$Country[order(death_minmax2$`Mean_death_ID`)])

```

```{r}
ggplot(death_minmax2, aes(x= Country, y= `Mean_death_ID`)) + geom_bar(stat = "identity") + labs(title="Infectious diseases per total number of death(10 countries mean enrolment", x="Country", y="mean death by Infectious diseases (%)") +  scale_y_continuous(limits = c(0, NA), breaks = pretty_breaks(n = 10),labels = comma_format()) + scale_fill_discrete(name = "Country") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

```
```{r}
waterAcess_mean <- waterAccess %>%
  group_by(Country) %>%
  summarise(water_access = mean(`Water withdrawal per capita ()`))

waterAcess_mean <- waterAcess_mean %>% filter(water_access > 0.1)

waterAcess_valmax <- waterAcess_mean %>% top_n(5, wt = water_access)

waterAcess_valmin <- waterAcess_mean %>% slice_min(water_access, n = 5)

waterAcess_minmax <- rbind(waterAcess_valmin, waterAcess_valmax)

waterAcess_minmax$Country <- factor(waterAcess_minmax$Country, levels = waterAcess_minmax$Country[order(waterAcess_minmax$water_access)])


pays_h3a_death <- select(annualdeath,Country,Year,`Infectious diseases prop (%)`) %>% filter(Country %in% c("Denmark","Monaco","United Kingdom","Cyprus","Sweden","Estonia","Hungary","Japan" ,"Libya","Spain")) 


```

```{r}
ggplot(data = pays_combinés_waterAcess, aes(x = Year, y = `Water withdrawal per capita ()`, group = Country, color = Country)) +
  geom_line() +
  labs(title = "Water withdrawal per capita per country(top 5 and bottom 5 countries in the world)",
       x = "Year",
       y = "Water withdrawal per capita ()") +
  theme_minimal() +
 scale_color_manual(values = couleurs)
```

```{r}


ggplot(data = pays_h3a_death, aes(x = Year, y = `Infectious diseases prop (%)`, group = Country, color = Country)) +
  geom_line() +
  labs(title = "Infectious diseases per total number of death (bottom 5 coutries from water withdrawal per capita)",
       x = "Year",
       y = "Infectious diseases prop (%)") +
  theme_minimal() +
 scale_color_manual(values = couleurs) 

```

```{r}


ggplot(data = pays_h3b_death, aes(x = Year, y = `Infectious diseases prop (%)`, group = Country, color = Country)) +
  geom_line() +
  labs(title = "Infectious diseases per total number of death (top 5 coutries from water withdrawal per capita)",
       x = "Year",
       y = "Infectious diseases prop (%)") +
  theme_minimal() +
 scale_color_manual(values = couleurs) 

```